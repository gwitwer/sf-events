services:
  - type: web
    name: sf-events
    runtime: python
    buildCommand: "chmod +x build.sh && ./build.sh"
    startCommand: "uvicorn server_db:app --host 0.0.0.0 --port $PORT"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DATABASE_URL
        value: sqlite:///events.db
      - key: RENDER
        value: "true"
      - key: SCRAPE_DAYS_AHEAD
        value: "14"  # Only scrape next 2 weeks of events for faster processing
      - key: LOGFIRE_WRITE_TOKEN
        sync: false  # This will use the value from Render dashboard
    autoDeploy: false

  # Cron job to trigger scraping via API
  - type: cron
    name: sf-events-scraper
    runtime: python
    schedule: "0 */12 * * *"  # Every 12 hours at minute 0
    buildCommand: "pip install requests logfire"
    startCommand: "pip install requests logfire && python run_scraper.py"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: SERVICE_URL
        value: https://sf-events.onrender.com  # Update with your actual URL
      - key: SCRAPE_DAYS_AHEAD
        value: "14"  # Only scrape next 2 weeks of events for faster processing
      - key: LOGFIRE_WRITE_TOKEN
        sync: false  # This will use the value from Render dashboard